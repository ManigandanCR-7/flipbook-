<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flipbook with Turn.js & Sound</title>
  <style>
    :root{
      --bg:#111; /* matte black background */
      --fg:#000000; 
      --muted:#666;
      --page-width:535.5px; 
      --page-height:638px;
    }
    body{
      margin:0; padding:20px; background:var(--bg); color:var(--fg);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
      display:flex; flex-direction:column; align-items:center; gap:20px;
      overflow:hidden; /* no scrollbars */
    }
    header{
      max-width:1100px;width:100%;
      display:flex;justify-content:space-between;align-items:center;
      color:white;
    }
    h1{margin:0;font-size:20px;font-weight:600;}
    input[type=file]{padding:8px;}
    button{
      padding:6px 12px;
      background:#fff;
      border:none;
      border-radius:4px;
      cursor:pointer;
      font-size:14px;
    }
    #flipbook{
      width:calc(var(--page-width)*2);
      height:var(--page-height);
      margin:auto;
    }
    .page{
      width:var(--page-width);
      height:var(--page-height);
      background:white;
      box-shadow:0 4px 10px rgba(0,0,0,0.3);
      display:flex;
      justify-content:center;
      align-items:center;
      overflow:hidden;
    }
    .page img{max-width:100%;max-height:100%;display:block;}
    @media(max-width:900px){
      :root{--page-width:320px;--page-height:460px;}
      #flipbook{width:calc(var(--page-width)*2);}
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/blasten/turn.js/turn.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>
<body>
  <header>
    <h1>Flipbook Viewer</h1>
    <div>
      <input id="file-input" type="file" accept="application/pdf" />
      <button id="fullscreen-btn">Fullscreen</button>
    </div>
  </header>
  <div id="flipbook"></div>

  <!-- Page flip sound -->
  <audio id="flip-sound" preload="auto">
    <source src="flipcard-91468.mp3" type="audio/mpeg">
  </audio>

  <script>
    if(typeof pdfjsLib!=='undefined'){
      pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
    }

    const fileInput=document.getElementById('file-input');
    const fullscreenBtn=document.getElementById('fullscreen-btn');
    const flipSound=document.getElementById('flip-sound');

    function playFlipSound(){
      flipSound.currentTime = 0;
      flipSound.play();
    }

    function clearFlipbook(){
      if($("#flipbook").data("turn")){
        $('#flipbook').turn('destroy').empty();
      }else{
        $('#flipbook').empty();
      }
    }

    fileInput.addEventListener('change',async e=>{
      const file=e.target.files[0];
      if(!file||file.type!=='application/pdf'){alert('Please select a PDF.');return;}
      clearFlipbook();

      const pdf=await pdfjsLib.getDocument({data:await file.arrayBuffer()}).promise;
      const imgs=[];
      for(let n=1;n<=pdf.numPages;n++){
        const page=await pdf.getPage(n);
        const vp=page.getViewport({scale:1});
        const tw=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--page-width'));
        const sc=tw/vp.width;
        const svp=page.getViewport({scale:sc});
        const c=document.createElement('canvas');
        c.width=svp.width; c.height=svp.height;
        await page.render({canvasContext:c.getContext('2d'),viewport:svp}).promise;
        imgs.push(c.toDataURL());
      }

      imgs.forEach((src,i)=>{
        const d=document.createElement('div');
        d.className='page';
        const im=document.createElement('img');
        im.src=src; im.alt='Page '+(i+1);
        d.appendChild(im);
        document.getElementById('flipbook').appendChild(d);
      });

      const pw=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--page-width'));
      const ph=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--page-height'));

      $('#flipbook').turn({
        width:pw*2,
        height:ph,
        autoCenter:true,
        display:'double',
        gradients:true,
        elevation:50,
        duration:1500, // slow smooth turn
        when:{
          turned: function(){ playFlipSound(); } // play sound when page turns
        }
      });

      // Keyboard arrow controls
      document.addEventListener('keydown',function(ev){
        if(ev.key==='ArrowRight'){$('#flipbook').turn('next');}
        if(ev.key==='ArrowLeft'){$('#flipbook').turn('previous');}
      });

      // Click edge to turn
      $('#flipbook').on('click', function(e){
        const offset = $(this).offset();
        const center = offset.left + $(this).width()/2;
        if(e.pageX > center){
          $('#flipbook').turn('next');
        } else {
          $('#flipbook').turn('previous');
        }
      });

      // Touch swipe for mobile
      let touchStartX=0;
      document.getElementById('flipbook').addEventListener('touchstart', e=>{
        touchStartX=e.changedTouches[0].screenX;
      });
      document.getElementById('flipbook').addEventListener('touchend', e=>{
        let diff=e.changedTouches[0].screenX - touchStartX;
        if(Math.abs(diff) > 50){
          if(diff < 0){
            $('#flipbook').turn('next'); // swipe left
          } else {
            $('#flipbook').turn('previous'); // swipe right
          }
        }
      });
    });

    // Fullscreen toggle
    fullscreenBtn.addEventListener('click',()=>{
      const elem = document.documentElement;
      if(!document.fullscreenElement){
        elem.requestFullscreen().catch(err=>alert(`Error: ${err.message}`));
      } else {
        document.exitFullscreen();
      }
    });
  </script>
</body>
</html>
